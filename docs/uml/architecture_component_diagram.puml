@startuml OCRix Architecture
!theme plain
skinparam componentStyle rectangle
skinparam shadowing false

title OCRix - Component Architecture Diagram

package "Presentation Layer" {
    [HomeScreen] as home
    [ScannerScreen] as scanner
    [DocumentListScreen] as doclist
    [DocumentDetailScreen] as docdetail
    [LoginScreen] as login
    [SettingsScreen] as settings

    package "Widgets" {
        [CameraPreview]
        [DocumentCard]
        [DocumentGrid]
        [SearchBar]
    }
}

package "State Management (Riverpod)" {
    [DocumentNotifier] as docnotifier
    [ScannerNotifier] as scannotifier
    [AuthNotifier] as authnotifier
    [BiometricAuthNotifier] as bionotifier
    [SettingsProvider] as settingsprov

    note right of docnotifier
        Manages document list state
        with pagination & filtering
    end note
}

package "Business Logic Layer" {
    package "Services" {
        [DatabaseService] as db
        [OCRService] as ocr
        [CameraService] as camera
        [EncryptionService] as encrypt
        [StorageProviderService] as storage
        [ImageProcessingService] as imgproc
        [AuditLoggingService] as audit
        [AuthService] as auth
    }

    package "Models" {
        [Document]
        [DocumentPage]
        [AuditLog]
        [UserSettings]
    }

    package "Utilities" {
        [ErrorHandler]
        [NavigationObserver]
        [AppInitializer]
    }
}

package "Data Layer" {
    database "SQLite Database" {
        [documents table]
        [document_pages table]
        [audit_entries table]
        [user_settings table]
    }

    [File System] as filesystem
    [Secure Storage] as secstore

    package "External APIs" {
        [Google ML Kit] as mlkit
        [Google Sign-In] as gsignin
        [Google Drive API] as gdrive
    }
}

' Presentation to State Management
home --> docnotifier
scanner --> scannotifier
login --> authnotifier
settings --> settingsprov
doclist --> docnotifier

' State Management to Services
docnotifier --> db
docnotifier --> audit
scannotifier --> camera
scannotifier --> ocr
scannotifier --> imgproc
scannotifier --> db
authnotifier --> auth
settingsprov --> db
settingsprov --> encrypt

' Services to Models
db ..> Document : uses
db ..> DocumentPage : uses
db ..> UserSettings : uses
audit ..> AuditLog : uses

' Services to Data Layer
db --> [documents table]
db --> [document_pages table]
db --> [audit_entries table]
db --> [user_settings table]
storage --> filesystem
storage --> gdrive
encrypt --> secstore
ocr --> mlkit
auth --> gsignin
imgproc --> filesystem

' Cross-cutting concerns
ErrorHandler .down.> audit : logs errors
NavigationObserver .down.> audit : tracks navigation

note right of db
    SQLite with FTS5
    full-text search
    and encryption
end note

note right of ocr
    On-device text
    recognition using
    Google ML Kit
end note

note right of audit
    Comprehensive audit
    logging with chain
    linking & checksums
end note

@enduml
